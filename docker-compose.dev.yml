version: '3.8'

# Development docker-compose with hot reload and debugging
services:
  healthcare-rag-api-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: healthcare-rag-dev
    image: healthcare-rag-assistant:dev
    
    ports:
      - "8000:8000"
    
    environment:
      - API_KEYS=${API_KEYS:-dev-key-12345}
      - ENV=development
      - LOG_LEVEL=DEBUG
      - HOST=0.0.0.0
      - PORT=8000
      - EMBEDDING_MODEL=paraphrase-multilingual-MiniLM-L12-v2
      - EMBEDDING_DIM=384
      - TRANSLATION_MODEL_EN_JA=Helsinki-NLP/opus-mt-en-jap
      - TRANSLATION_MODEL_JA_EN=Helsinki-NLP/opus-mt-jap-en
      - FAISS_INDEX_DIR=/app/data/faiss_index
    
    volumes:
      # Mount source code for hot reload
      - ./app:/app/app:ro
      # Persist data
      - ./data:/app/data
      - ./logs:/app/logs
      # Mount docs for testing
      - ./docs:/app/docs:ro
    
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    
    networks:
      - rag_network
    
    # Enable stdin for debugging
    stdin_open: true
    tty: true

networks:
  rag_network:
    driver: bridge

